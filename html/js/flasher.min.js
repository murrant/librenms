!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Flasher=e()}(this,(function(){"use strict";var t=function(){function t(){this.factories=new Map}return t.getInstance=function(){return t.instance||(t.instance=new t),t.instance},t.prototype.render=function(t){var e=this;this.addStyles(t.styles,(function(){e.addScripts(t.scripts,(function(){e.renderOptions(t.options),e.renderEnvelopes(t.envelopes,t.context)}))}))},t.prototype.addStyles=function(t,e){var n=this;if(0!==t.length)if(null===document.querySelector('link[href="'+t[0]+'"]')){var o=document.createElement("link");o.setAttribute("href",t[0]),o.setAttribute("type","text/css"),o.setAttribute("rel","stylesheet"),o.onload=function(){return n.addStyles(t.slice(1),e)},document.head.appendChild(o)}else this.addStyles(t.slice(1),e);else"function"==typeof e&&e()},t.prototype.addScripts=function(t,e){var n=this;if(0!==t.length)if(null===document.querySelector('script[src="'+t[0]+'"]')){var o=document.createElement("script");o.setAttribute("src",t[0]),o.setAttribute("type","text/javascript"),o.onload=function(){return n.addScripts(t.slice(1),e)},document.body.appendChild(o)}else this.addScripts(t.slice(1),e);else"function"==typeof e&&e()},t.prototype.renderOptions=function(t){var e=this;Object.entries(t).forEach((function(t){var n=t[0],o=t[1],i=e.create(n);void 0!==i&&i.renderOptions(o)}))},t.prototype.renderEnvelopes=function(e,n){var o=this,i=new Map;e.forEach((function(e){e.context=n;var s=o.create(e.handler);void 0!==s&&(t.isQueueable(s)?(i.get(e.handler)||s.resetQueue(),s.addEnvelope(e),i.set(e.handler,s)):s.render(e))})),i.forEach((function(t){t.renderQueue()}))},t.prototype.create=function(t){return 0===t.indexOf("template.")?this.factories.get("template"):this.factories.get(t)},t.prototype.addFactory=function(t,e){this.factories.set(t,e)},t.isQueueable=function(t){return"function"==typeof t.addEnvelope&&"function"==typeof t.renderQueue},t}(),e=function(){return(e=Object.assign||function(t){for(var e,n=1,o=arguments.length;n<o;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)},n=function(){function t(){this.options={timeout:5e3,fps:30,position:"top-right",direction:"top",x_offset:"0.5em",y_offset:"0"}}return t.prototype.render=function(e){var n=this,o=e.notification,i=t.stringToHTML(e.template||"");if(i){i.style.transition="0.8s",void 0!==o.options&&void 0!==o.options.position&&(this.options.position=o.options.position);var s=document.getElementById("flasher-container-"+this.options.position);if(null===s){switch((s=document.createElement("div")).id="flasher-container-"+this.options.position,s.style.position="fixed",s.style.maxWidth="304px",s.style.width="100%",s.style.zIndex="999999",this.options.position){case"top-left":s.style.top=this.options.y_offset,s.style.left=this.options.x_offset;break;case"top-right":s.style.top=this.options.y_offset,s.style.right=this.options.x_offset;break;case"bottom-left":s.style.bottom=this.options.y_offset,s.style.left=this.options.x_offset;break;case"bottom-right":default:s.style.bottom=this.options.y_offset,s.style.right=this.options.x_offset}document.getElementsByTagName("body")[0].appendChild(s)}switch(this.options.direction){case"top":s.insertBefore(i,s.firstChild);break;case"bottom":default:s.appendChild(i)}var r=i.querySelector(".flasher-progress");if(r instanceof HTMLElement){var a,c=0,f=1e3/this.options.fps,p=function(){var t=100*(1-f*((c+=1)/n.options.timeout));r.style.width=t+"%",t<=0&&(i.style.opacity="0",clearInterval(a),setTimeout((function(){i.remove()}),900))};a=setInterval(p,f),i.addEventListener("mouseover",(function(){clearInterval(a)})),i.addEventListener("mouseout",(function(){a=setInterval(p,f)}))}}},t.prototype.renderOptions=function(t){this.options=e(e({},this.options),t)},t.stringToHTML=function(t){if(function(){if(!DOMParser)return!1;var t=new DOMParser;try{t.parseFromString("x","text/html")}catch(t){return!1}return!0}())return(new DOMParser).parseFromString(t,"text/html").body.firstChild;var e=document.createElement("div");return e.innerHTML=t,e.firstElementChild},t}();return t.getInstance().addFactory("template",new n),t}));
